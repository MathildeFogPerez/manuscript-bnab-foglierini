# manuscript-bnab-foglierini

Scripts to convert paired BCRs data into a features table used to predict HIV BnAb using three different machine learning algorithms: AD (anomaly detection), DT (decision tree) and RF (random forest).

Copyright (C) 2023  Mathilde Foglierini Perez

email: mathilde.foglierini-perez@chuv.ch

### SUMMARY ###

We have made available here a series of scripts to process scBCR sequencing data coming from HIV-1 immune donors in order to find BnAb in their repertoires. 
The scripts are primarily intended as reference for manuscript "###TOADD###" rather than a stand-alone application.

Raw data are available at https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?&acc=GSE229123

These scripts were run on a Linux machine.


### LICENSE ###

This code is distributed open source under the terms of the Apache License, Version 2.0.


### INSTALL ###

#### Paireds BCR repertoires processing 

As previously described [here](https://github.com/MathildeFogPerez/manuscript-rep-phad/tree/main) we developped a pipeline to generate a cutomized table of paired BCRs in AIRR format.

The following software are required:

a) Java JDK 15 https://www.oracle.com/java/technologies/javase/jdk15-archive-downloads.html

b) IgBlast v1.17.1  or download latest version from https://ftp.ncbi.nih.gov/blast/executables/igblast/release/LATEST

c) Change-O https://changeo.readthedocs.io/en/stable/install.html#installation

#### Machine learning algorithms

The jupyter notebook can be run after installing the following Python libraries (using Python 3.8.16):
- scikit-learn v1.0.2
- matplotlib 3.6.2
- scipy 1.8.1
- pandas 1.4.2
- seaborn 0.11.2  
- numpy 1.22.3
- graphviz 0.20
 

### PIPELINE ###

1. Create a directory for each experiment and create a metadata.txt file in each directory:

        sample cellType newSampleId colDate donor ag
        G4 M G4 2302 P4 none

2. Launch the bash script that will result into a customized paired BCRs table in AIRR format

        cellranger_out_to_AIRRfile.sh /MY_WORKING_DIR/ P4 G4 >out_pipeline_G4.txt


3. Execute the jar file to convert the AIRR file into our features of interest table

        java -jar PrepareFeaturesTableFromAirrFile.jar G4 MY_WORKING_DIR/HIVdonors_AIRR/G4/AIRR_file_G4.tsv

4. Launch the jupyter notebooks by setting the experiment name and path: run first the AnomalyDetection_PUB.ipynb and then the DecisionTree_RandomForest_PUB.ipynb

The execution of the jupyter notebooks generate the different figures and files used for the publication:
 * creation of an 'output' folder with related files for the training and validation models for each antigenic site
 * a predicted bnabs file in AIRR format (+ features columns) for each experiment and each antigenic site

<br/><br/>
     
#### Note 1:

All the files generated by the Java script PrepareFeaturesTableFromAirrFile.jar can be found in each subfolder of the 'HIVdonors_AIRR' folder, along with their related AIRR file.

A java script is also available for the conversion of VDJ_Dominant_Contigs.csv BD Rhapsody file to cellranger-like output files (filtered_contig_annotations.csv and filtered_contig.fasta).


<br/><br/>

#### Note 2:
Input files for the training and validation models, AIRR files and features tables of HIV-1 immune donors experiments will be released upon publication.

 


